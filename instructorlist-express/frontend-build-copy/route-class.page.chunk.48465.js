webpackJsonp([0],{"1uTM":function(e,t,n){"use strict";n.d(t,"a",function(){return r});var r=function(e){return Object.entries(e).filter(function(e){return e[1]}).map(function(e){return e[0]}).join(" ")};t.b=r},"6hN1":function(e){e.exports={classDetailWrapper:"classDetailWrapper__2T8mX",heroImage:"heroImage__Qr4BU",back:"back__1aQJI",timeLabel:"timeLabel__1dmWn",main:"main__ieBPs",mainTitle:"mainTitle__3QRdT",address:"address__teZVQ",description:"description__25Gbt",section:"section__1vexu",title:"title__gjFEQ",instructorAvatar:"instructorAvatar__25zFg",well:"well__372E6",wellIcon:"wellIcon__3hDcb",wellMain:"wellMain__1JhNM",wellDescription:"wellDescription__1PEH9",wellAction:"wellAction__3j7JB",priceLabel:"priceLabel__3dyS3"}},Dnk9:function(e){e.exports={footer:"footer__YnoJr",hide:"hide__3aVn4",disabled:"disabled__gp8z1",button:"button__2PQ5O"}},GjWG:function(e){e.exports={formContainer:"formContainer__1XJ08"}},"Kb/3":function(e,t,n){"use strict";function r(e){if(null==e)throw new TypeError("Cannot destructure undefined")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function a(e){if(null==e)throw new TypeError("Cannot destructure undefined")}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function l(){return new Promise(function(e,t){return Promise.resolve(new Promise(function(e){return x()("https://js.stripe.com/v3/",e)})).then(function(){try{return e()}catch(e){return t(e)}},t)})}function p(e){if(null==e)throw new TypeError("Cannot destructure undefined")}function h(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function m(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function f(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function d(e){if(null==e)throw new TypeError("Cannot destructure undefined")}function b(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function y(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function v(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var _=n("KM04"),j=(n("vbq8"),n("/QC5")),O=n("6hN1"),w=n.n(O),g=n("Mmjd"),P=n.n(g),N=n("1uTM"),C=n("Dnk9"),S=n.n(C),k=function(e){function t(){for(var t,n,r,i=arguments.length,a=Array(i),s=0;s<i;s++)a[s]=arguments[s];return t=n=o(this,e.call.apply(e,[this].concat(a))),n.onClick=function(e){if(n.props.disabled)return e.preventDefault();n.props.onClick(e)},r=t,o(n,r)}return i(t,e),t.prototype.render=function(e,t){var n,o=e.children,i=e.disabled,a=e.hide;return r(t),Object(_.h)("div",{className:Object(N.b)((n={},n[S.a.footer]=!0,n[S.a.disabled]=i,n[S.a.hide]=a,n))},Object(_.h)("button",{className:S.a.button,onClick:this.onClick,type:"submit"},o))},t}(_.Component),T={1:"Mon",2:"Tue",3:"Wed",4:"Thu",5:"Fri",6:"Sat",7:"Sun"},M=n("GjWG"),A=n.n(M),E=n("r4pm"),x=n.n(E),D=n("fitr"),q=Object(_.h)("div",{id:"cc-form"}),B=function(e){function t(){return s(this,t),c(this,e.apply(this,arguments))}return u(t,e),t.prototype.shouldComponentUpdate=function(){return!1},t.prototype.componentDidMount=function(){this.props.card.mount("#cc-form")},t.prototype.render=function(){return q},t}(_.Component),I=Object(_.h)("div",{id:"payment-request-button"}),R=function(e){function t(){var n,r,o;s(this,t);for(var i=arguments.length,a=Array(i),u=0;u<i;u++)a[u]=arguments[u];return n=r=c(this,e.call.apply(e,[this].concat(a))),r.mount=function(){return new Promise(function(e,t){var n;return Promise.resolve(r.props.paymentRequest.canMakePayment()).then(function(o){try{return n=o,n?r.props.prButton.mount("#payment-request-button"):document.getElementById("payment-request-button").style.display="none",r.props.paymentRequest.on("paymentmethod",r.props.onPaymentMethod),e()}catch(e){return t(e)}},t)})},o=n,c(r,o)}return u(t,e),t.prototype.componentDidMount=function(){this.mount()},t.prototype.render=function(){return I},t}(_.Component),L=Object(_.h)("div",null,"Loading stripe"),F=function(e){function t(n){s(this,t);var r=c(this,e.call(this,n));return r.onSubmit=function(e){return new Promise(function(t){return console.log("onstripesubmit"),t(r.onSubmitCard(e))})},r.onSubmitCard=function(){return new Promise(function(e,t){var n,o,i;return Promise.resolve(r.stripe.createPaymentMethod("card",r.state.card)).then(function(a){try{return n=a,console.log("res",n),o=n.billingDetails,r.setState({billingDetails:o}),Promise.resolve(r.confirm("method",{payment_method_id:n.paymentMethod.id,amount:r.getAmount()})).then(function(n){try{return i=n,i.error?e(i):i.requires_action?e(r.handleAction(i)):e()}catch(e){return t(e)}},t)}catch(e){return t(e)}},t)})},r.handleAction=function(e){return new Promise(function(t,n){var o,i,a;return Promise.resolve(r.stripe.handleCardAction(e.payment_intent_client_secret)).then(function(e){try{return o=e,o.error?(console.log("errorAction",o.error),t(o.error)):(i={payment_intent_id:o.paymentIntent.id,amount:r.getAmount()},Promise.resolve(r.confirm("intent",i)).then(function(e){try{return a=e,console.log("response",a),t(a)}catch(e){return n(e)}},n))}catch(e){return n(e)}}.bind(this),n)})},r.confirm=function(e,t){return new Promise(function(n,r){var o,i;return console.log("body",t),Promise.resolve(fetch(D.a+"/api/payment-"+e+"/confirm/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})).then(function(e){try{return o=e,Promise.resolve(o.json()).then(function(e){try{return i=e,console.log("confirmed",i),n(i)}catch(e){return r(e)}},r)}catch(e){return r(e)}},r)})},r.onSubmitCard1=function(){return new Promise(function(e,t){var n,o,i;return Promise.resolve(r.getClientSecret()).then(function(a){try{return n=a,o=n.client_secret,console.log("clientSecret",o),Promise.resolve(r.stripe.handleCardSetup(o,r.state.card,{})).then(function(n){try{return i=n,e(i.error?i:r.onSuccessfulCardSetup(i))}catch(e){return t(e)}},t)}catch(e){return t(e)}},t)})},r.getAmount=function(){return 100*parseFloat(r.props.amount)},r.onError=function(e){r.props.onError(e)},r.getClientSecret=function(){return new Promise(function(e,t){var n;return Promise.resolve(fetch(D.a+"/api/intent/"+r.getAmount()+"/")).then(function(r){try{return n=r,(console.log("res",n),n.ok)?e(n.json()):(console.log("err",n),e(n))}catch(e){return t(e)}},t)})},r.onPaymentMethod=function(e){return new Promise(function(t,n){var o,i,a,s,c,u,l;return Promise.resolve(r.getClientSecret()).then(function(p){try{return o=p,i=o.client_secret,Promise.resolve(r.stripe.confirmPaymentIntent(i,{payment_method:e.paymentMethod.id})).then(function(o){function i(){return t()}try{return a=o,s=a.error,c=a.paymentIntent,s?(e.complete("fail"),i.call(this)):(e.complete("success"),Promise.resolve(r.stripe.handleCardPayment(clientSecret)).then(function(e){try{return u=e,l=u.error,l?console.log("The payment failed -- ask your customer for a new payment method."):console.log("The payment has succeeded."),i.call(this)}catch(e){return n(e)}}.bind(this),n))}catch(e){return n(e)}}.bind(this),n)}catch(e){return n(e)}}.bind(this),n)})},r.state={loadingStripe:!0,responses:[]},r.props.onSubmit(r.onSubmit),r}return u(t,e),t.prototype.componentDidMount=function(){return new Promise(function(e,t){function n(){return this.setState({loadingStripe:!1}),this.stripe=window.Stripe("pk_test_i0mT0MQhBYOTm3kcHw73xILH"),this.elements=this.stripe.elements(),r=this.elements.create("card",{hidePostalCode:!0}),o=this.stripe.paymentRequest({country:"GB",currency:"gbp",total:{label:"Class price",amount:this.getAmount()},requestPayerName:!0,requestPayerEmail:!0}),i=this.elements.create("paymentRequestButton",{paymentRequest:o}),this.setState({card:r,prButton:i,paymentRequest:o}),e()}var r,o,i;return"Stripe"in window?n.call(this):Promise.resolve(l()).then(function(){try{return n.call(this)}catch(e){return t(e)}}.bind(this),t)}.bind(this))},t.prototype.render=function(e,t){var n=t.res;return a(e),Object(_.h)("div",null,this.state.loadingStripe?L:Object(_.h)("div",{className:A.a.formContainer},Object(_.h)(R,{paymentRequest:this.state.paymentRequest,prButton:this.state.prButton,onPaymentMethod:this.onPaymentMethod}),Object(_.h)(B,{card:this.state.card}),Object(_.h)("pre",null,JSON.stringify(n,null,2))))},t}(_.Component),W=Object(_.h)("div",null,"Class not found"),J=Object(_.h)("div",null),Q=Object(_.h)("div",{className:"hr"}),G=Object(_.h)("div",{className:"hr"}),H=Object(_.h)("div",{className:"hr"}),V=Object(_.h)("div",{className:"bottom"}),U=Object(_.h)("div",null,"Pay now"),z=function(e){function t(n){h(this,t);var r=m(this,e.call(this,n));return r.onChange=function(){return function(){}},r.onSubmit=function(e){return new Promise(function(t,n){function o(){return t()}var i;return e.preventDefault(),e.stopPropagation(),console.log("onsubmit"),r.state.stripeToken?o.call(this):Promise.resolve(r.stripeSubmit(e)).then(function(e){try{return i=e,console.log("res2",i),i.error&&r.setState({error:i.error.message}),o.call(this)}catch(e){return n(e)}}.bind(this),n)})},r.state={formIsValid:!1,stripeToken:null},r}return f(t,e),t.prototype.render=function(e,t){var n,r=this,o=e.item,i=e.show;return p(t),o?Object(_.h)("div",null,Object(_.h)("form",{className:Object(N.b)((n={},n[P.a.paymentWrapper]=!0,n[P.a.close]=!i,n))},Object(_.h)("div",{className:P.a.paymentMain},Object(_.h)("div",{className:P.a.paymentHeader},Object(_.h)("div",{className:"leftArrow "+P.a.back,onClick:this.props.onClose}),Object(_.h)("div",{className:P.a.title},"Checkout"),J),Q,Object(_.h)("div",{className:P.a.section},Object(_.h)("div",{className:P.a.classTitle},o.title),Object(_.h)("div",{className:P.a.time},T[o.day]," ",o.start_time," - ",o.end_time),Object(_.h)("div",{className:P.a.location},o.venue.name," - ",o.venue.area)),G,Object(_.h)("div",{className:P.a.section},Object(_.h)("div",{className:P.a.titleContainer},Object(_.h)("div",{className:P.a.title},"Total"),Object(_.h)("div",{className:P.a.titleAside},"£",parseFloat(o.price).toFixed(2))),o.extra_fee&&Object(_.h)("div",{className:P.a.extra},"Please note this studio will charge you an additional",Object(_.h)("div",{className:P.a.strong},"£",o.extra_fee," studio entry fee"),"upon arrival.")),H,Object(_.h)("div",{className:P.a.section},Object(_.h)("div",{className:P.a.titleContainer},Object(_.h)("div",{className:P.a.title},"Payment")),this.state.error&&Object(_.h)("div",{className:"errorContainer"},Object(_.h)("div",{className:"errorContainer_message"},this.state.error)),Object(_.h)("div",{className:P.a.paymentForm},Object(_.h)("div",{className:P.a.inputContainer},Object(_.h)("input",{type:"text",className:P.a.input,placeholder:"Phone number",onChange:this.onChange("phone")})),i&&Object(_.h)(F,{amount:o.price,onSubmit:function(e){r.stripeSubmit=e}}))),V),Object(_.h)(k,{hide:!i,onClick:this.onSubmit},U))):W},t}(_.Component),K=Object(_.h)("div",null,"Class not found"),X=Object(_.h)("div",{className:"leftArrow"}),Y=Object(_.h)("div",{className:"directions"}),Z=Object(_.h)("div",{className:"rightArrow"}),$=Object(_.h)("div",{className:"rightArrow"}),ee=function(e){function t(n){b(this,t);var r=y(this,e.call(this,n));return r.onBack=function(e){if(e.preventDefault(),e.stopPropagation(),r.props.i)return window.history.back();Object(j.route)("/search/")},r.hidePayment=function(){r.setState({showPayment:!1})},r.state={item:r.props.data.state.classes[n.matches.id],showPayment:!0},r}return v(t,e),t.prototype.componentDidMount=function(){return new Promise(function(e,t){var n;return Promise.resolve(this.props.data.getClass(this.props.matches.id)).then(function(r){try{return n=r,this.setState({item:n}),e()}catch(e){return t(e)}}.bind(this),t)}.bind(this))},t.prototype.render=function(e,t){var n=this,r=t.item,o=t.showPayment;if(d(e),!r)return K;var i=r.instructors[0],a=i.profile||{bio:""};return Object(_.h)("div",null,Object(_.h)(z,{show:o,onClose:this.hidePayment,item:r}),Object(_.h)("div",{className:w.a.classDetailWrapper},Object(_.h)("div",{className:w.a.classHero},Object(_.h)("div",{className:w.a.heroImage},Object(_.h)("img",{src:r.hero_image_url||"/assets/images/class.jpeg",alt:r.title}),Object(_.h)("a",{onClick:this.onBack,href:"/search",className:""+w.a.back},X),Object(_.h)("div",{className:w.a.timeLabel},T[r.day].toUpperCase()," ",r.start_time," -"," ",r.end_time))),Object(_.h)("div",{className:w.a.main},Object(_.h)("div",{className:w.a.mainTitle},r.title),Object(_.h)("div",{className:w.a.address},r.venue.name," ",r.venue.area),Object(_.h)("a",{href:r.venue.google_maps_url?r.venue.google_maps_url:"https://www.google.co.uk/maps/dir//"+r.venue.address_line_1+" "+r.venue.postcode,target:"_blank",className:w.a.well,style:{borderTop:"1px solid var(--off-white)"}},Object(_.h)("div",{className:w.a.wellIcon},Y),Object(_.h)("div",{className:w.a.wellMain},Object(_.h)("div",{className:w.a.wellName},r.venue.name),Object(_.h)("div",{className:w.a.wellDescription},r.venue.address_line_1,", ",r.venue.postcode)),Object(_.h)("div",{className:w.a.wellAction},Z)),Object(_.h)("a",{className:w.a.well,href:""+a.slug},Object(_.h)("div",{className:w.a.wellIcon},Object(_.h)("img",{className:w.a.instructorAvatar,src:a.profile_image_url||"https://api.adorable.io/avatars/60/"+i.email+".png",alt:i.name})),Object(_.h)("div",{className:w.a.wellMain},Object(_.h)("div",{className:w.a.wellName},i.name),Object(_.h)("div",{className:w.a.wellDescription},a.bio.substring(0,50))),Object(_.h)("div",{className:w.a.wellAction},$)),r.description&&Object(_.h)("div",{className:w.a.section},Object(_.h)("div",{className:w.a.title},"About"),Object(_.h)("div",{className:w.a.description},r.description)))),Object(_.h)(k,{onClick:function(){return n.setState({showPayment:!0})}},Object(_.h)("div",null,"£",r.price),Object(_.h)("div",{className:w.a.priceLabel},"Book now")))},t}(_.Component);ee.getInitialProps=function(e){var t=e.id;return new Promise(function(e){fetch("https://instructorlist-django.herokuapp.com/api/classes/"+t).then(function(t){t.json().then(function(t){return e(t)})})})};t.default=ee},Mmjd:function(e){e.exports={paymentWrapper:"paymentWrapper__1x25b",close:"close__1l-EC",paymentMain:"paymentMain__2L3VM",paymentHeader:"paymentHeader__3BZWN",back:"back__1GJnh",title:"title__1Os6k",section:"section__2SSUU",time:"time__IA1AL",classTitle:"classTitle__2boOm",titleContainer:"titleContainer__O_OAw",extra:"extra__ktVQ8",strong:"strong__ved2L",paymentForm:"paymentForm__TFqeV",inputContainer:"inputContainer__13SbB"}},r4pm:function(e,t){var n,r,o;!function(i,a){r=[],n=a,void 0!==(o="function"==typeof n?n.apply(t,r):n)&&(e.exports=o)}(0,function(){function e(e,t){e=e.push?e:[e];var n,r,o,i,a=[],s=e.length,l=s;for(n=function(e,n){n.length&&a.push(e),--l||t(a)};s--;)r=e[s],o=c[r],o?n(r,o):(i=u[r]=u[r]||[],i.push(n))}function t(e,t){if(e){var n=u[e];if(c[e]=t,n)for(;n.length;)n[0](e,t),n.splice(0,1)}}function n(e,t){e.call&&(e={success:e}),t.length?(e.error||a)(t):(e.success||a)(e)}function r(e,t,n,o){var i,s,c=document,u=n.async,l=(n.numRetries||0)+1,p=n.before||a,h=e.replace(/^(css|img)!/,"");o=o||0,/(^css!|\.css$)/.test(e)?(s=c.createElement("link"),s.rel="stylesheet",s.href=h,(i="hideFocus"in s)&&s.relList&&(i=0,s.rel="preload",s.as="style")):/(^img!|\.(png|gif|jpg|svg)$)/.test(e)?(s=c.createElement("img"),s.src=h):(s=c.createElement("script"),s.src=e,s.async=void 0===u||u),s.onload=s.onerror=s.onbeforeload=function(a){var c=a.type[0];if(i)try{s.sheet.cssText.length||(c="e")}catch(e){18!=e.code&&(c="e")}if("e"==c){if((o+=1)<l)return r(e,t,n,o)}else if("preload"==s.rel&&"style"==s.as)return s.rel="stylesheet";t(e,c,a.defaultPrevented)},!1!==p(e,s)&&c.head.appendChild(s)}function o(e,t,n){e=e.push?e:[e];var o,i,a=e.length,s=a,c=[];for(o=function(e,n,r){if("e"==n&&c.push(e),"b"==n){if(!r)return;c.push(e)}--a||t(c)},i=0;i<s;i++)r(e[i],o,n)}function i(e,r,i){function a(r,i){o(e,function(e){n(u,e),r&&n({success:r,error:i},e),t(c,e)},u)}var c,u;if(r&&r.trim&&(c=r),u=(c?i:r)||{},c){if(c in s)throw"LoadJS";s[c]=!0}if(u.returnPromise)return new Promise(a);a()}var a=function(){},s={},c={},u={};return i.ready=function(t,r){return e(t,function(e){n(r,e)}),i},i.done=function(e){t(e,[])},i.reset=function(){s={},c={},u={}},i.isDefined=function(e){return e in s},i})},vbq8:function(){}});
//# sourceMappingURL=route-class.page.chunk.48465.js.map